<template>
    <div class="order">
        <div class="top">
            <b class="f16">收益报表</b>
            <div class="qs"></div>
        </div>
        <div style="height: 2.05rem;"></div>
        <div class="main">
            <div class="header">
                <div>可提现金额</div>
                <div class="flex balance">
                    <div class="item"><b class="f20">{statistical.balance}</b> 元</div>
                    <div class="tx">提现</div>
                </div>
            </div>
            <div class="flex income">
                <div class="item">
                    <div class="icon icon1">收入明细</div>
                </div>
                <Divider height="25" />
                <div class="item">
                    <div class="icon icon2">退税报备</div>
                </div>
            </div>

            <div class="flex statistical">
                <div class="item">
                    <div class="g9 f12">上月预估收入（元）</div>
                    <div class="f16" style="margin-top: 0.4rem">{statistical.preMonthIncome}</div>
                </div>
                <Divider height="44" />
                <div class="item">
                    <div class="g9 f12">本月预估收入（元）</div>
                    <div class="f16" style="margin-top: 0.4rem">{statistical.currMonthIncome}</div>
                </div>
            </div>
            <div class="explain">每月20号结算上月预估收入，建议21号再进行提现<div class="qs"></div>
            </div>

            <div class="item-list">
                <div class="head-title">CPS报表</div>
                <div class="body">
                    <div class="title flex">
                        <div class="icon"></div>
                        <div class="item">全部订单明细</div>
                        <div style="margin-right: 0.5rem;"><img width="16" :src="iconRight" /></div>
                    </div>
                    <div class="inner">
                        <div class="btn-group">
                            <div :class="'btn-item ' + (range === 1 ? 'active' : '')" onclick="handleChangeRange(1)">今日</div>
                            <div :class="'btn-item ' + (range === 2 ? 'active' : '')" onclick="handleChangeRange(2)">昨日</div>
                            <div :class="'btn-item ' + (range === 3 ? 'active' : '')" onclick="handleChangeRange(3)">近7日</div>
                            <div :class="'btn-item ' + (range === 4 ? 'active' : '')" onclick="handleChangeRange(4)">近30日</div>
                        </div>
                        <div class="total">
                            <div class="item">
                                <div class="g9 f12">点击数</div>
                                <div class="count">{sData.clickNum}</div>
                            </div>
                            <div class="item">
                                <div class="g9 f12">付款订单(笔)<div class="qs"></div>
                                </div>
                                <div class="count">{sData.orderNum}</div>
                            </div>
                            <div class="item" style="margin-top: 1.3rem;">
                                <div class="g9 f12">付款预估收入(元)<div class="qs"></div>
                                </div>
                                <div class="count">{sData.income}</div>
                            </div>
                            <div class="item" style="margin-top: 1.3rem;">
                                <div class="g9 f12">结算预估收入(元)
                                </div>
                                <div class="count">{sData.settlement}</div>
                            </div>
                        </div>
                    </div>
                    <div class="feeter">
                        <span>查看更多数据</span>
                        <img width="16" :src="iconRightTheme" />
                    </div>
                </div>
            </div>

            <div class="item-list">
                <div class="head-title">CPA报表</div>
                <div class="body">
                    <div class="title flex">
                        <div class="icon icon2"></div>
                        <div class="item">分月结算明细</div>
                        <div style="margin-right: 0.5rem;"><img width="16" :src="iconRight" /></div>
                    </div>
                </div>
            </div>

            <div style="height: 3rem;"></div>
        </div>
        <Nav :active="3"></Nav>
    </div>
</template>
<script>
    import Nav from '@/components/Nav.html';
    import Divider from '@/components/Divider.html';
    import './order.less';

    export default {
        name: 'order',
        component: {
            Nav,
            Divider
        },
        data() {
            return {
                range: 1,
                iconRight: require('../assets/icons/icon-right-black.png'),
                iconRightTheme: require('../assets/icons/icon-right-theme.png'),
                tabCurrentIndex: 0,
                sData: {},
                statistical: {}
            }
        },
        methods: {
            handleChangeRange(range) {
                if (range === 1) {
                    this.setData({
                        range,
                        sData: {
                            clickNum: this.data.statistical.todayClickNum,
                            orderNum: this.data.statistical.todayOrderNum,
                            income: this.data.statistical.todayIncome,
                            settlement: this.data.statistical.todaySettlement,
                        }
                    });
                } else if (range === 2) {
                    this.setData({
                        range,
                        sData: {
                            clickNum: this.data.statistical.yesterdayClickNum,
                            orderNum: this.data.statistical.yesterdayOrderNum,
                            income: this.data.statistical.yesterdayIncome,
                            settlement: this.data.statistical.yesterdaySettlement,
                        }
                    });
                } else if (range === 3) {
                    this.setData({
                        range,
                        sData: {
                            clickNum: this.data.statistical.recent7daysClickNum,
                            orderNum: this.data.statistical.recent7daysOrderNum,
                            income: this.data.statistical.recent7daysIncome,
                            settlement: this.data.statistical.recent7daysSettlement,
                        }
                    });
                } else if (range === 4) {
                    this.setData({
                        range,
                        sData: {
                            clickNum: this.data.statistical.recent30daysClickNum,
                            orderNum: this.data.statistical.recent30daysOrderNum,
                            income: this.data.statistical.recent30daysIncome,
                            settlement: this.data.statistical.recent30daysSettlement,
                        }
                    });
                }

            }
        },
        mounted() {
            if (localStorage.getItem('staticstical')) {
                this.setData({
                    statistical: JSON.parse(localStorage.getItem('staticstical'))
                }, () => {
                    this.handleChangeRange(1);
                });
            }
            this.request.get('/api/get_statistical')
                .then((res) => {
                    localStorage.setItem('staticstical', JSON.stringify(res.data.entity));

                    this.setData({
                        statistical: res.data.entity
                    }, () => {
                        this.handleChangeRange(1);
                    });
                });
        },
        beforeCreate() {
            // 给flutter webview通信
            try {
                FlutterSetAppbarColor.postMessage('255,255,255,1');
            } catch (error) {

            }
        },
    }
</script>